@page "/UserProfile"
@inherits LayoutComponentBase
@using DataBasHunters.Shared
@inject HttpClient Http
@inject NavigationManager NavigationManager

<div class="container">
    @if (vm != null)
    {
            <div class="ProfileGrid">
                <div>
                    <p>Profile Picture: <img src="@vm.user.Profilepicture" alt="Profile Picture" /></p>
                </div>
                <div>
                    <h1>@vm.user.Id - @vm.user.Username</h1>
                    <h1>@vm.user.Funds kr</h1>
                </div>
            </div>
       
        <div>
            <h3>Transaction History</h3>
            @if (vm.history != null && vm.history.Any())
            {
                <table class="table">
                    <thead>
                        <tr>
                            <th>Transaction ID</th>
                            <th>Sum</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var transaction in vm.history)
                        {
                            <tr>
                                <td>@transaction.Id</td>
                                <td>@transaction.Sum</td>
                                <td>@transaction.Date</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p>No transaction history available.</p>
            }
        </div>
    }
    else
    {
        <p>Please log in to view your profile.</p>
    }
</div>

<style>
    .ProfileGrid {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        align-items: center;
        margin: 10% 2% 10% 2%;
    }
</style>

@code {
    private ViewModelProfile vm;

    protected override async Task OnInitializedAsync()
    {
        // Retrieve information about the logged-in user
        // You need to implement a mechanism to get the logged-in user's information
        // This is just a placeholder, and you should replace it with the actual logic.

        // Make an HTTP request to UserProfile action to get user information
        var response = await Http.GetAsync("GetUser");

        if (response.IsSuccessStatusCode)
        {
            vm = await response.Content.ReadFromJsonAsync<ViewModelProfile>();
        }
        else
        {
            NavigationManager.NavigateTo("/Login");
        }
    }
}
